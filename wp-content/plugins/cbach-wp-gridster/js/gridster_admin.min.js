jQuery(function(j){var c;var e;var a=parseInt(gridster_admin.widget_base_width,10);var k=parseInt(gridster_admin.widget_base_height,10);var i=parseInt(gridster_admin.widget_margin_x,10);var g=parseInt(gridster_admin.widget_margin_y,10);j.fn.resizeBlock=function(o){var l=o.width()-a;var n=o.height()-k;for(var m=1;l>0;l-=(a+(i*2))){m++}for(var p=1;n>0;n-=(k+(g*2))){p++}c.resize_widget(o,m,p);c.set_dom_grid_height()};j.fn.updateGridsterLayoutSettings=function(){var l=c.serialize();j("input#gridster_layout").val(JSON.stringify(l));return};var d={grid:[a+(i*2),k+(g*2)],animate:false,minWidth:a,minHeight:k,handles:"se",autoHide:true,start:function(l,m){e=c.$el.height()},resize:function(n,o){if(j(this).find("img").length){j(this).addClass("isUpdated")}var q=k+g*2;if(typeof n.offsetX==="undefined"||typeof n.offsetY==="undefined"){var p=j(n.target).offset();n.offsetX=n.pageX-p.left;n.offsetY=n.pageY-p.top}if(n.offsetY>c.$el.height()){var l=Math.floor((n.offsetY-e)/q+1);var m=e+l*q;c.$el.css("height",m)}},stop:function(m,n){var l=j(this);setTimeout(function(){j.fn.resizeBlock(l);if(j(l).find("img").length){j.fn.refreshWidgetHtml(l.data().post_id,false,l)}j.fn.updateGridsterLayoutSettings()},300)}};var h={no_results_text:gridster_admin.chosenNoResultsText};c=j(".gridster ul").gridster({widget_margins:[i,g],widget_base_dimensions:[a,k],avoid_overlapped_widgets:true,serialize_params:function(o,l){var n=j.trim(j("<div/>").text(j(o).find(".admin-html-holder").html()).html());var m=j(o).find(".dynamic-classes-chosen").val();return{size_x:l.size_x,size_y:l.size_y,col:l.col,row:l.row,id:j(o).attr("data-post_id"),html:n,classes:m}},draggable:{handle:".move-handle",stop:function(l,m){j.fn.updateGridsterLayoutSettings()}},collision:{on_overlap_start:function(l){},on_overlap_stop:function(l){}}}).data("gridster");j(".gridster").droppable({drop:function(m,n){var l=j(n.draggable).attr("rel");j.fn.updateQueryNotInField(l);n.helper.remove();j("#gridster_load-wrap").fadeIn();j.fn.refreshWidgetHtml(l,true)}});j.fn.refreshWidgetHtml=function(o,l,m){l=typeof l!=="undefined"?l:false;m=typeof m!=="undefined"?m:false;var n={post_id:o,widget_width:(m)?m.width():a,widget_height:(m)?m.height():k};j.ajax({type:"GET",url:gridster_admin.ajaxUrl,dataType:"html",data:({action:"ajax_gridster_get_post",nonce:gridster_admin.ajaxNonce,options:n}),success:function(p){if(p=="-1"||p===""||p===0||p=="undefined"){var r=j("#gridster_loader p").html();j("#gridster_loader").addClass("error");j("#gridster_loader p").text(gridster_admin.textAjaxLoadProblem);j("#gridster_load-wrap").fadeOut(5000,function(){j("#gridster_loader").removeClass("error");j("#gridster_loader p").html(r)})}else{if(l===true){var q=j("<li>").attr("data-post_id",o).html(p);q.resizable(d);q.append(j.fn.AddUiElemnts());c.add_widget(q,1,1);j.fn.initChosen(j('li.gs_w[data-post_id="'+o+'"]'));j.fn.updateGridsterLayoutSettings();j("#gridster_load-wrap").fadeOut()}else{j(m).find("div.admin-html-holder").replaceWith(p);j(m).removeClass("isUpdated");j.fn.updateGridsterLayoutSettings()}j.fn.initJeditable()}}})};j.fn.updateQueryNotInField=function(o,l){l=typeof l!=="undefined"?l:false;var s=parseInt(o,10);var r=j("input#gridster_query_posts_not_in").val();if(l!==false){var n=r.split(",");n=n.map(function(t){return parseInt(t,10)});var m=n.indexOf(s);if(m<0){return}n.splice(m,1);j("input#gridster_query_posts_not_in").val(n.join(","));return}var p=new RegExp("(^|\\b)"+s+"(\\b|$)");if(!p.test(r)){var q=r+(r.length?",":"")+o;j("input#gridster_query_posts_not_in").val(q)}return};j.fn.AddUiElemnts=function(){var l=j("<div />").addClass("meta-label");j("<span />").attr("title",gridster_admin.textMoveHandle).text(gridster_admin.textMoveHandle).addClass("ir move-handle").appendTo(l);j("<span />").attr("title",gridster_admin.textDelete).text(gridster_admin.textDelete).addClass("ir delete-post").appendTo(l);return l};j(document).on({mouseenter:function(){c.disable()},mouseleave:function(){c.enable()}},".ui-resizable-handle");j(document).on("click",".gridster li .admin-html-holder a",function(l){l.preventDefault()});j(".delete-post").live("click",function(){j(this).parent().parent().hide("fast",function(){var l=parseInt(j(this).data().post_id,10);j.fn.updateQueryNotInField(l,true);c.remove_widget(j(this));j.fn.updateGridsterLayoutSettings()})});j.fn.initJeditable=function(){j(".gridster_edit").editable(function(m,l){return(m)},{onblur:"submit",data:function(l){return j.trim(l)},placeholder:"",callback:function(m,l){j.fn.updateGridsterLayoutSettings()}});j(".gridster_edit-area").editable(function(m,l){return(m)},{type:"autogrow",cancel:gridster_admin.JeditableCancel,submit:gridster_admin.JeditableOk,onblur:"submit",data:function(l){return j.trim(l)},placeholder:"",autogrow:{lineHeight:16,minHeight:32},callback:function(m,l){j.fn.updateGridsterLayoutSettings()}});j(".gridster_edit-area").on("click",function(){j('button[type="submit"]').addClass("button-primary");j('button[type="cancel"]').addClass("button-secondary")})};j.fn.initJeditable();j.fn.initChosen=function(n){if(gridster_admin.chosenSelectOptions!="[]"){var o=parseInt((n.width()-50-80),10);var p=(o>100)?o:100;var m=j("<select>").attr("multiple",true).attr("data-placeholder",gridster_admin.chosenSelectPlaceholder).addClass("dynamic-classes-chosen").width(p);var l=JSON.parse(gridster_admin.chosenSelectOptions);j.each(l,function(q,s){var r=j("<option>").val(q).text(s);if(n.hasClass(q)){r.attr("selected",true)}r.appendTo(m)});m.insertBefore(n.find("div.meta-label > span:first"));j("select.dynamic-classes-chosen").chosen(h).change(function(){j.fn.updateGridsterLayoutSettings()})}};j.fn.LoadWidgetsOnStart=function(){var m=j("input#gridster_layout").val();if(m===""||m==[]){return false}j("#gridster_load-wrap").fadeIn();var l=JSON.parse(m);j(l).each(function(){var p=j(this)[0];var n=j("<div>").addClass("admin-html-holder").html(p.html);n=j("<li>").attr("data-post_id",p.id).append(n);n.resizable(d);if(typeof p.classes!="undefined"&&p.classes!==null){n.addClass(p.classes.join(" "))}n.append(j.fn.AddUiElemnts());c.add_widget(n,p.size_x,p.size_y,p.col,p.row);j.fn.initChosen(j('li.gs_w[data-post_id="'+p.id+'"]'))});j.fn.initJeditable();j("#gridster_load-wrap").fadeOut();j.fn.updateGridsterLayoutSettings();return false};j.fn.updateMetaboxLayout=function(){var n=parseInt(j(".gridster ul").data("content_width"),10);var p=parseInt(j("#gridster_workbench_metabox").width(),10);var l=280+20;if((j("#post-body").hasClass("columns-1")&&((n+l)<p))||(j("#gridster_workbench_metabox").hasClass("two-columns")&&((n+l)>p))){j("#gridster_workbench_metabox").removeClass("two-columns").addClass("one-column");var m=j(".gridster_widget-block");var o=Math.round(m.length/2);m.filter(function(q){return(q+1)<=o}).wrapAll('<div class="accordion-wrap" />');m.filter(function(q){return(q+1)>o}).wrapAll('<div class="accordion-wrap" />')}else{if((j("#post-body").hasClass("columns-2")&&((n+l)<p))||(j("#gridster_workbench_metabox").hasClass("one-column")&&((n+l)<p))){j("#gridster_workbench_metabox").addClass("two-columns").removeClass("one-column");j(".accordion-wrap .gridster_widget-block").unwrap()}}};j.fn.getPostsByType=function(o,m,l){l=(typeof l!=="undefined"&&typeof l!=="object")?l:"";var n={post_type:o,paged:m,search:l};j.ajax({type:"GET",url:gridster_admin.ajaxUrl,dataType:"html",data:({action:"ajax_get_posts_by_type_widget_block",nonce:gridster_admin.ajaxNonce,options:n,post:j("#post_ID").val()}),success:function(q){if(q=="-1"||q===""||q===0||q=="undefined"){var p=j("<p />").text(gridster_admin.textAjaxNothingFound);p=j("<div />").addClass("error").append(p);j("#gridster_post_type-"+o+"-widget-block").find(".inside").html(p)}else{j("#gridster_post_type-"+o+"-widget-block").find(".inside").html(q);j(".gridster_widget-block li").draggable({revert:"invalid"})}j("#gridster_post_type-"+o+"-widget-block").find(".spinner").hide()}})};j(".gridster_widget-block").each(function(){var l=j(this).data("post_type");j.fn.getPostsByType(l,paged=1)});j(document).on("click",".widget-blocks-pagination",function(){j(this).parentsUntil(".gridster_widget-block").parent().find(".spinner").show();var n=j(this).parentsUntil(".gridster_widget-block").parent().data("post_type");var m=j(this).data("paged");var l=(j(this).data("search"))?j(this).data("search"):null;j.fn.getPostsByType(n,m,l)});var b;var f=2000;j(document).on("keydown",".gridster_search-posts-by-type",function(l){if(l.which==13){l.preventDefault()}});j(document).on("keydown",".gridster_search-posts-by-type",function(l){clearTimeout(b)});j(document).on("keyup",".gridster_search-posts-by-type",function(m){var l=j(this);if(m.which==13){j.fn.doneTyping(l)}else{b=setTimeout(function(){j.fn.doneTyping(l)},f)}});j.fn.doneTyping=function(l){l.parentsUntil(".gridster_widget-block").parent().find(".spinner").show();var o=l.parentsUntil(".gridster_widget-block").parent().data("post_type");var n=1;var m=j.trim(l.val());j.fn.getPostsByType(o,n,m)}});jQuery(document).ready(function(c){c.fn.WidgetBlockAccordion=function(d){if(d.parent().hasClass("trigger_active")){d.siblings(".inside").slideToggle("fast");d.parent().removeClass("trigger_active");d.parent().siblings(".trigger_active").removeClass("trigger_active")}else{d.parent().siblings(".trigger_active").removeClass("trigger_active").find(".inside").slideToggle("fast");d.siblings(".inside").slideToggle("fast");d.parent().addClass("trigger_active")}return false};c(".gridster_widget-block h3, .gridster_widget-block .handlediv").not(".trigger_active").siblings(".inside").hide();c(".gridster_widget-block h3, .gridster_widget-block .handlediv").click(function(){c.fn.WidgetBlockAccordion(c(this))});c(".gridster_widget-block:first h3").trigger("click");var b=c(".gridster ul").data("content_width");c("<div />").addClass("content_width-border").attr("title",gridster_admin.textMaximumContentWidth).css("left",b+"px").appendTo(c(".gridster"));c.fn.LoadWidgetsOnStart();c.fn.updateMetaboxLayout();c(window).resize(function(){c.fn.updateMetaboxLayout()});c("#collapse-menu").on("click.collapse-menu",function(){setTimeout(function(){c.fn.updateMetaboxLayout()},500)});c(".columns-prefs input").on("change",function(){setTimeout(function(){c.fn.updateMetaboxLayout()},500)});var a=["input#visibility-radio-password",'label[for="visibility-radio-password"] + br','label[for="visibility-radio-password"]',"span#password-span"];c.each(a,function(e,d){c(d).remove()})});